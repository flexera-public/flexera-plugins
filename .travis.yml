language: ruby
cache:
  directories:
  - bundle
rvm:
- 2.4.1
bundler_args: "--without documentation --path bundle"
before_install:
- git fetch --depth=1
- gem install bundler
- mkdir -p tmp && wget --no-check-certificate https://binaries.rightscale.com/rsbin/rsc/v8/rsc-linux-amd64.tgz && tar zxvf rsc-linux-amd64.tgz -C tmp;mv tmp/rsc/rsc . && chmod +x ./rsc && ./rsc --version
script:
- bundle exec danger --verbose
- bundle exec rake generate_plugin_list
deploy:
# generate the active plugin list json file
- provider: script
  script: bundle exec rake generate_plugin_list
# upload the active plugin list json file to s3  
- provider: s3
  bucket: rs-policysync-tool
  region: us-east-1
  skip_cleanup: true
  local_dir: "$TRAVIS_BUILD_DIR/$WORK_DIR/dist"
  acl: public_read
  access_key_id: "$PLUGIN_SYNC_TOOL_S3_AWS_ACCESS_KEY_ID"
  secret_access_key: "$PLUGIN_SYNC_TOOL_S3_AWS_SECRET_ACCESS_KEY"
  on:
    branch: test_pub
